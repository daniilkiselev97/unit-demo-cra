name: Create Release
on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - 'v[0-9]+' # Push events to matching v*, i.e. v1.0, v20.15.10



jobs:
  build:
    permissions: write-all
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - id: date
        run: echo "date="$(git log -1 --format=%ai ${{github.ref}}) >> "$GITHUB_OUTPUT"
      - id: author
        run: echo "author="$(git log -1 --format=%an ${{github.ref}}) >> "$GITHUB_OUTPUT"
      - id: prev_tag
        run: echo "prev_tag="$(git describe --abbrev=0 --tags --exclude="$(git describe --abbrev=0 --tags)^") >> "$GITHUB_OUTPUT"
      - run: echo ${{steps.prev_tag.outputs.prev_tag}}
      - id: changelog
        run: echo "changelog="$(git log --pretty=oneline ${{ steps.prev_tag.outputs.prev_tag }}...${{github.ref}}) >> "$GITHUB_OUTPUT"
      - name: Create Release
        uses: ncipollo/release-action@v1
        id: create_release
        with:
          tag: ${{ github.ref }}
          name: ${{ github.ref }}
          body: |
            ${{steps.date.outputs.date}} ${{steps.author.outputs.author}}
            Changes in this Release
            ${{steps.changelog.outputs.changelog}}